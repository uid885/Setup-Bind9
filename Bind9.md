#Author: Christo Deale <br>
#Date: 2023-10-18

# Setup DNS (Bind9) Server on RHEL 9 & Configure RHEL 9 clients

## Step 1: Install BIND

```
sudo dnf install bind
```
## Step 2: Configure BIND

**2.1** Create a new BIND configuration file by copying the default sample configuration:
```
sudo cp /usr/share/doc/bind/sample/etc/named.conf /etc/named.conf
```
**2.2** Edit the /etc/named.conf file with a text editor, such as nano or vim:
```
sudo vim /etc/named.conf
```
Replace the entire contents of the file with the following:
```
acl "trusted" {
    192.168.0.0/24;   # Replace this with your trusted network or IP range.
};

options {
    directory "/var/named";
    listen-on port 53 { any; };
    allow-query { any; };
    forwarders { 8.8.8.8; 8.8.4.4; };
    recursion yes;
};

zone "example.co.za"   #your domain here
{
    type master;
    file "/etc/named/zones/example.co.za.zone";   # your domain here
    allow-query { "trusted"; };
};
```
This configuration sets up BIND to listen on all network interfaces (any), allows queries from any IP address, and forwards DNS requests to Google's DNS servers (you can change these forwarders if you prefer).

## 3. Create a DNS Zone File

**3.1**
Create a DNS zone file for your domain (example.co.za) by creating a new file in the /etc/named/zones/ directory. You can choose a different directory if you prefer:
```
sudo mkdir /etc/named/zones
sudo vim /etc/named/zones/example.co.za.zone  # your domain here
```
**3.2** In the example.co.za.zone file, add the following DNS zone configuration:
```
$ORIGIN example.co.za.      # your domain here
$TTL 1D
@       IN      SOA     ns1.example.co.za. admin.example.co.za ( # your domain here
                        2023091201 ; Serial
                        3H ; refresh
                        15 ; retry
                        1w ; expiry
                        1D ) ; minimum

; Define name servers
@       IN      NS      ns1.example.co.za.  # your domain here
ns1     IN      A       192.168.0.11        # your dns server ip here

; Define hostname to IP mappings
serv-01   IN      A       192.168.0.11     # your server ip here
```

## Step 4. Set File Permissions

**4.1** Ensure that the BIND user can read the zone files:
```
sudo chown -R named:named /etc/named/zones/example.co.za.zone
sudo chmod -R 755 /etc/named/zones/example.co.za.zone
sudo chmod 644 /etc/named.conf
named-checkzone example.co.za /etc/named/zones/example.co.za.zone
```

## Step 5. Start & Enable BIND

```
sudo systemctl start named
sudo systemctl enable named
sudo systemctl status named.service
```
## Step 6. Configure DNS Resolution on Clients

**6.1** On your RHEL 9 clients, you need to configure them to use the BIND DNS server for name resolution. 
```
sudo nmcli con mod ens160 ipv4.dns-search "example.co.za"
```
**6.2** Edit the following line in the resolv.conf, replacing BIND_SERVER_IP with your actual IP address of  your BIND server:
```
sudo vim /etc/resolv.conf
```
```
# Generated by NetworkManager
search example.co.za
nameserver BIND_SERVER_IP
nameserver BIND_SERVER_IP
```
**6.3** Add the ipv4.dns-search to your connection & restart the Network Manager.
```
sudo systemctl restart NetworkManager
```
